<!-- IF S_REACTIONS_ENABLED and not S_IS_BOT and S_USER_LOGGED_IN -->
<!-- Bloc pour les utilisateurs connectés avec interactions complètes -->
<div class="post-reactions-container" data-post-id="{postrow.POST_ID}">
    <div class="post-reactions">
        <!-- Réactions depuis la DB (gérées par le listener PHP) -->
        <!-- BEGIN postrow.post_reactions -->
        <span class="reaction<!-- IF postrow.post_reactions.USER_REACTED --> active<!-- ENDIF -->"
              data-emoji="{postrow.post_reactions.EMOJI}"
              data-count="{postrow.post_reactions.COUNT}"
              title="{postrow.post_reactions.COUNT} réaction<!-- IF postrow.post_reactions.COUNT != 1 -->s<!-- ENDIF -->"
              <!-- IF postrow.post_reactions.COUNT == 0 -->style="display: none;"<!-- ENDIF -->>
            {postrow.post_reactions.EMOJI}
            <span class="count">{postrow.post_reactions.COUNT}</span>
        </span>
        <!-- END postrow.post_reactions -->
        
        <!-- Bouton pour palette - SEULEMENT pour les utilisateurs connectés -->
        <span class="reaction-more" title="Ajouter une réaction">+</span>
        
        <!-- IF postrow.list_reactions|length > 0 -->
            <span class="reaction-who" title="Qui a réagi ?" onclick="toggle_visible('lst_{postrow.POST_ID}')">?</span>
            <div class="list-who" id="lst_{postrow.POST_ID}" style="display:none;">
                <ul>
                <!-- BEGIN postrow.list_reactions -->
                    <li>{postrow.list_reactions.EMOJI} {postrow.list_reactions.NOM}</li>
                <!-- END postrow.list_reactions -->
                </ul>
            </div>
        <!-- ENDIF -->
    </div>
</div>

<!-- ELSEIF S_REACTIONS_ENABLED and not S_IS_BOT and not S_USER_LOGGED_IN -->
<!-- Affichage en lecture seule pour les utilisateurs non connectés -->
<div class="post-reactions-container post-reactions-readonly" data-post-id="{postrow.POST_ID}">
    <div class="post-reactions">
        <!-- BEGIN postrow.post_reactions -->
            <!-- IF postrow.post_reactions.COUNT > 0 -->
            <span class="reaction reaction-readonly"
                  data-emoji="{postrow.post_reactions.EMOJI}"
                  data-count="{postrow.post_reactions.COUNT}"
                  title="{postrow.post_reactions.COUNT} réaction<!-- IF postrow.post_reactions.COUNT != 1 -->s<!-- ENDIF -->">
                {postrow.post_reactions.EMOJI}
                <span class="count">{postrow.post_reactions.COUNT}</span>
            </span>
            <!-- ENDIF -->
        <!-- END postrow.post_reactions -->
        
        <!-- IF postrow.list_reactions|length > 0 -->
            <span class="reaction-who" title="Qui a réagi ?" onclick="toggle_visible('lst_{postrow.POST_ID}')">?</span>
            <div class="list-who" id="lst_{postrow.POST_ID}" style="display:none;">
                <ul>
                <!-- BEGIN postrow.list_reactions -->
                    <li>{postrow.list_reactions.EMOJI} {postrow.list_reactions.NOM}</li>
                <!-- END postrow.list_reactions -->
                </ul>
            </div>
        <!-- ENDIF -->
    </div>
</div>
<!-- ENDIF -->